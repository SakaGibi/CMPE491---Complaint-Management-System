<div class="management-panel-container">
  <!-- Header -->
  <div class="header-panel">
    <div class="logo">
      <img src="assets/images/bilgiUni.png"/>  </div>
    <div>
      <button class="btn btn-header" (click)="goToMainMenu()">Main Menu</button>
      <button class="btn btn-header" (click)="goToSupport()">Help & Support</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-area">
    <div class="left-section">
        <!-- Chart Preview -->
        <div class="chart-container" (click)="openChartModal()">
          <h2>Complaint Chart</h2>
          <canvas baseChart
            [data]="barChartData"
            [labels]="barChartLabels"
            [options]="{ responsive: true, plugins: { legend: { display: false } } }"
            [type]="'bar'">
          </canvas>
        </div>
      
        <!-- Trend Preview -->
        <div class="graph-container" (click)="openTrendModal()">
          <h2>Complaint Trends</h2>
          <canvas baseChart
            [data]="lineChartData"
            [labels]="lineChartLabels"
            [options]="{ responsive: true, plugins: { legend: { display: false } } }"
            [type]="'line'">
          </canvas>
        </div>
      
        <!-- Chart Modal -->
        <div class="fullscreen-modal" *ngIf="isChartModalOpen">
          <div class="modal-content">
            <button class="close-btn" (click)="closeChartModal()">X</button>
            <div class="modal-detail">
              <h2>Complaint Chart</h2>
              <label for="chart-range">Select Range:</label>
              <select id="chart-range" [(ngModel)]="chartRange" (change)="fetchComplaintStatistics(chartRange)">
                <option value="">All Time</option>
                <option value="7d">Last 7 Days</option>
                <option value="1m">Last 1 Month</option>
                <option value="3m">Last 3 Months</option>
                <option value="6m">Last 6 Months</option>
              </select>
              <canvas baseChart
                [data]="barChartData"
                [labels]="barChartLabels"
                [options]="barChartOptions"
                [type]="'bar'">
              </canvas>
            </div>
          </div>
        </div>
      
        <!-- Trend Modal -->
        <div class="fullscreen-modal" *ngIf="isTrendModalOpen">
          <div class="modal-content">
            <button class="close-btn" (click)="closeTrendModal()">X</button>
            <div class="modal-detail">
              <h2>Complaint Trends</h2>
              <label for="trend-range">Select Range:</label>
              <select id="trend-range" [(ngModel)]="trendRange" (change)="fetchComplaintTrends(trendRange, trendCategory)">
                <option value="">All Time</option>
                <option value="7d">Last 7 Days</option>
                <option value="1m">Last 1 Month</option>
                <option value="3m">Last 3 Months</option>
                <option value="6m">Last 6 Months</option>
              </select>
            
              <label for="trend-category">Category:</label>
              <select id="trend-category" [(ngModel)]="trendCategory" (change)="fetchComplaintTrends(trendRange, trendCategory)">
                <option value="">All</option>
                <option *ngFor="let cat of ALL_CATEGORIES" [value]="cat">{{ cat }}</option>
              </select>
            
              <canvas
                baseChart
                [data]="lineChartData"
                [options]="lineChartOptions"
                [type]="'line'">
              </canvas>
            </div>
          </div>
    </div>
             
  </div>

    <!-- Center Section: Complaints List -->
    <div class="center-section">
      <div class="complaints-header">
        <div class="complaints-title">
          <h2>All Complaints</h2>
          <button class="btn btn-refresh" (click)="refreshComplaintsAndChart()">↻ Yenile</button>
        </div>
        <div class="filters">
          <div class="filter-row">
            <label>Status:</label>
            <select [(ngModel)]="selectedStatus" (change)="fetchComplaints()">
              <option value="">All</option>
              <option value="new">New</option>
              <option value="in_progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="reopened">Reopened</option>
              <option value="closed">Closed</option>
            </select>
        
            <label>Category:</label>
            <select [(ngModel)]="selectedCategory" (change)="fetchComplaints()">
              <option value="">All</option>
              <option value="temizlik">Temizlik</option>
              <option value="gürültü">Gürültü</option>
              <option value="bakım ve onarım">Bakım ve Onarım</option>
              <option value="güvenlik">Güvenlik</option>
              <option value="Ortak Alan Kullanımı">Ortak Alan Kullanımı</option>
              <option value="yönetim">Yönetim</option>
            </select>
          </div>
        
          <div class="filter-row">
            <label>Trackable:</label>
            <select [(ngModel)]="selectedTrackable" (change)="fetchComplaints()">
              <option value="">All</option>
              <option value="true">Trackable</option>
              <option value="false">Not Trackable</option>
            </select>
        
            <label>Sort:</label>
            <select [(ngModel)]="selectedSortOption" (change)="fetchComplaints()">
              <option value="">Sort by</option>
              <option value="newest">Newest → Oldest</option>
              <option value="oldest">Oldest → Newest</option>
            </select>
          </div>
        </div>
      </div>
      <div class="complaints-list">
        <ul *ngIf="complaintList.length > 0; else noComplaints">
          <li *ngFor="let complaint of complaintList" (click)="openComplaintModal(complaint.id)">
            {{ complaint.description }}
          </li>
        </ul>
        <ng-template #noComplaints>
          <p>No complaints found.</p>
        </ng-template>
      </div>
    </div>

    <!-- Right Section: Reports -->
    <div class="right-section">
      <h2>Reports</h2>
      <!-- Yeni Rapor Oluşturma -->
      <div class="report-create">
        <div class="filter-pair">
          <div class="filter-item">
            <label>Report Name:</label>
            <input type="text" [(ngModel)]="newReportName" placeholder="Enter a report title..." />
          </div>

          <div class="filter-item">
            <label>Category:</label>
            <select [(ngModel)]="newReportFilters.category">
              <option value="">All</option>
              <option *ngFor="let cat of ALL_CATEGORIES" [value]="cat">{{ cat }}</option>
            </select>
          </div>
        </div>

        <div class="filter-pair">
          <div class="filter-item">
            <label>Status:</label>
            <select [(ngModel)]="newReportFilters.status">
              <option value="">All</option>
              <option value="new">New</option>
              <option value="in_progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="reopened">Reopened</option>
              <option value="closed">Closed</option>
            </select>
          </div>

          <div class="filter-item">
            <label>Trackable:</label>
            <select [(ngModel)]="newReportFilters.isTrackable">
              <option value="">All</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>

        <div class="filter-pair">
          <div class="filter-item">
            <label>From:</label>
            <input type="date" [(ngModel)]="newReportFilters.date_from" />
          </div>

          <div class="filter-item">
            <label>To:</label>
            <input type="date" [(ngModel)]="newReportFilters.date_to" />
          </div>
        </div>

        <div class="filter-pair">
          <button class="btn btn-submit" (click)="generateNewReport()" [disabled]="isLoadingReport">
            {{ isLoadingReport ? 'Generating...' : 'Create Report' }}
          </button>
        </div>
      </div>


      <!-- Rapor Listesi -->
      <div class="reports-list">
        <ul *ngIf="reportList.length > 0; else noReports">
          <li *ngFor="let report of reportList">
            <strong>{{ report.report_type }}</strong> <br />
            <small>{{ report.created_at }}</small>
            <div class="report-actions">
              <button (click)="openReportDetail(report.id)">View</button>
              <button (click)="deleteReport(report.id)">Delete</button>
            </div>
          </li>
        </ul>
        <ng-template #noReports>
          <p>No Reports found.</p>
        </ng-template>
      </div>
      <!-- Modal: Rapor Detayları -->
      <div class="fullscreen-modal" *ngIf="isReportModalOpen">
        <div class="modal-content report-modal">
          <button class="close-btn" (click)="closeReportModal()">X</button>
          <div class="modal-detail">
            <h2>{{ selectedReport?.report_type }}</h2>
            <pre style="white-space: pre-wrap; font-size: 14px; line-height: 1.6;">
              {{ selectedReport?.content }}
            </pre>
          </div>
        </div>
      </div>
    </div>
    
  </div>

  <!-- Modal: Suggestion Details -->
  <div class="fullscreen-modal" *ngIf="isSuggestionModalOpen">
    <div class="modal-content">
      <button class="close-btn" (click)="closeSuggestionModal()">X</button>
      <div class="modal-detail">
        <h2>Suggestion Details</h2>
        <p><strong>ID:</strong> {{ selectedSuggestion?.id }}</p>
        <p><strong>Description:</strong> {{ selectedSuggestion?.description }}</p>
        <p><strong>Category:</strong> {{ selectedSuggestion?.category || 'N/A' }}</p>
        <p><strong>Email:</strong> {{ selectedSuggestion?.email || 'N/A' }}</p>
        <p><strong>Status:</strong> {{ selectedSuggestion?.status }}</p>
        <p><strong>Created:</strong> {{ selectedSuggestion?.created_at | date:'short' }}</p>
        <p><strong>Updated:</strong> {{ selectedSuggestion?.updated_at | date:'short' }}</p>
        <hr>
        <button class="btn btn-danger" (click)="deleteSuggestion()">Delete Suggestion</button>
      </div>
    </div>
</div>

  <!-- Placeholder Modal for Chart/Graph -->
  <div class="fullscreen-modal" style="display: none">
    <div class="modal-content">
      <button class="close-btn">X</button>
      <div class="modal-detail">
        <h2>Modal Content</h2>
      </div>
    </div>
  </div>

<!-- Modal: Complaint Details -->
<div class="fullscreen-modal" *ngIf="isComplaintModalOpen">
  <div class="modal-content">
    <button class="close-btn" (click)="closeComplaintModal()">X</button>
    <div class="modal-detail">
      <h2>Complaint Details</h2>
      <p><strong>ID:</strong> {{ selectedComplaint?.id }}</p>
      <p><strong>Status:</strong> {{ selectedComplaint?.status }}</p>
      <p><strong>Description:</strong> {{ selectedComplaint?.description }}</p>
      <p><strong>Category:</strong> {{ selectedComplaint?.category }}</p>
      <p><strong>Sub-Category:</strong> {{ selectedComplaint?.sub_category }}</p>
      <p><strong>Email:</strong> {{ selectedComplaint?.email || 'N/A' }}</p>
      <p><strong>Created:</strong> {{ selectedComplaint?.created_at | date:'short' }}</p>
      <p><strong>Updated:</strong> {{ selectedComplaint?.updated_at | date:'short' }}</p>

      <hr>

      <label for="status">Update Status:</label>
      <select id="status" [(ngModel)]="selectedComplaintStatus">
        <option value="new">New</option>
        <option value="in_progress">In Progress</option>
        <option value="resolved">Resolved</option>
        <option value="reopened">Reopened</option>
        <option value="closed">Closed</option>
      </select>
      <button (click)="updateComplaintStatus()">Update Status</button>
      <hr>

      <button class="btn btn-danger" (click)="deleteComplaint()">Delete Complaint</button>
    </div>
  </div>
</div>
